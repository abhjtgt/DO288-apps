pipeline {
  options {
   timeout(time: 10, unit: 'MINUTES')
  }
  agent {
    node {
     label 'maven' 
    }
  }
  
  environment {
   PRO = "jentry2"
   APP = "myjen"
  }
  
  stages {
    stage('Build') {
      steps {
       echo "** Building" 
       echo "Project: ${PRO}"
        sh '''
        cd jentry
        oc delete all -l app=${APP} -n ${PRO}
        oc delete all -l build=${APP} -n ${PRO}
        mvn -s settings.xml package
        oc new-build --name ${APP} java:8 --binary=true -n ${PRO}
        echo "finding..."
        echo $(find . -name ${APP}.jar)
        '''
        
        script {
          openshift.withCluster() {
            openshift.withProject(env.PRO) {
              openshift.selector("bc", "${APP}").startBuild("--from-file=jentry/target/${APP}.jar", "--wait=true", "--follow=true")
            }
          }
        }
      }
    }
    
    stage('Test') {
      steps {
       echo "** Testing" 
      }
    }
    
    stage('Deploy') {
      steps {
       echo "** Deploying" 
      }
    }
  }
}
