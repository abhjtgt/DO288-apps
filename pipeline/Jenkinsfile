pipeline {
  options {
    timeout( time:30, unit:'MINUTES') 
  }
  environment {
   NAME = "ABHIJIT" 
    APPNAME = "movies"
    STAGE = "stage"
    NEXUS_SERVER = "http://nexus-common.apps.na45.prod.nextcle.com/repository/java"
  }
  agent {
    node {
      label 'maven' 
    }
  }
  
  stages {
    stage("BUILD") {
      steps {
        sh '''
          cd $APPNAME
          echo "Compiling on $NEXUS_SERVER"
          # mvn -s settings.xml clean compile
          
          echo "Packaging"
          mvn -s settings.xml clean package
          ls -lrt target
          echo "Building" 
          
          oc delete all -l app=${APPNAME} -n $STAGE
          oc delete all -l build=${APPNAME} -n $STAGE
          
          oc new-build --name=${APPNAME} --binary=true
        '''
      }
    }
  }
}
